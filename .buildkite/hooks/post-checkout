#!/bin/bash
set -euo pipefail

# Set default values for required variables
export BUILDKITE_FOLDER_GIT_REPO_PATH="${BUILDKITE_FOLDER_GIT_REPO_PATH:-https://github.com/albertfast/dagster.git}"
export BUILDKITE_FOLDER_GIT_REPO_DIR="${BUILDKITE_FOLDER_GIT_REPO_DIR:-/tmp/buildkite-folder}"
export DAGSTER_GIT_REPO_DIR=${DAGSTER_GIT_REPO_DIR:-/workdir}

echo "ðŸ”§ Setting up .buildkite folder from buildkite folder repository..."
echo "Repository root: $PWD"
echo "BUILDKITE_FOLDER_GIT_REPO_DIR = $BUILDKITE_FOLDER_GIT_REPO_DIR"
echo "BUILDKITE_FOLDER_GIT_REPO_PATH = $BUILDKITE_FOLDER_GIT_REPO_PATH"

# Use the existing script if available
if [ -f "scripts/copy_buildkite_folder.sh" ]; then
    bash scripts/copy_buildkite_folder.sh
    exit 0
fi

# Simple implementation as fallback
# No need to clone again if we already have the files in place
if [ -f ".buildkite/pipeline.yml" ]; then
    echo "âœ… .buildkite folder already exists, skipping clone."
    exit 0
fi

mkdir -p .buildkite
