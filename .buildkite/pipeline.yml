steps:
  - label: ":pytest: CLI Test"
    command: |
      python -m venv venv
      source venv/bin/activate
      pip install --upgrade pip
      pip install -e python_modules/libraries/dagster-shared
      pip install -e python_modules/dagster[dev]
      pytest -v python_modules/dagster/dagster_tests/cli_tests/test_project_commands.py
    agents:
      queue: "default"

  - label: ":sparkles: Format Check (ruff)"
    command: |
      python -m venv venv
      source venv/bin/activate
      pip install ruff
      ruff check python_modules/dagster/dagster/_generate/templates/
    agents:
      queue: "default"

  - label: ":hammer: Scaffold Definition Template"
    command: |
      python -m venv venv
      source venv/bin/activate
      pip install --upgrade pip
      pip install -e python_modules/libraries/dagster-shared
      pip install -e python_modules/dagster[dev]
      mkdir -p /tmp/test_scaffold
      cd /tmp/test_scaffold
      python -m dagster project scaffold --name test_project
      grep -q "@definitions" test_project/test_project/definitions.py && \
      grep -q "load_from_defs_folder" test_project/test_project/definitions.py && \
      echo "âœ… Template validation successful!"
    agents:
      queue: "default"
