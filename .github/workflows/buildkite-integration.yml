name: BuildKite Integration

on:
  push:
    branches:
      - issue-31069
      - install-buildkite-test-analytics
  pull_request:
    branches:
      - master
      - issue-31069

jobs:
  trigger-buildkite:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Trigger BuildKite Pipeline
        uses: buildkite/trigger-pipeline-action@v1.2.0
        with:
          buildkite-api-access-token: ${{ secrets.BUILDKITE_API_TOKEN }}
          pipeline: "issue-31069-test"
          branch: ${{ github.ref_name }}
          commit: ${{ github.sha }}
          message: "Using local pipeline.yml"
          build-env-vars: >-
            {
              "GITHUB_ACTOR": "${{ github.actor }}",
              "GITHUB_REPOSITORY": "${{ github.repository }}",
              "GITHUB_SHA": "${{ github.sha }}",
              "GITHUB_REF": "${{ github.ref }}"
            }
