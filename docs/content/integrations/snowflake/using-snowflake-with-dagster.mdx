---
title: "Integrating Snowflake with Dagster using resources | Dagster Docs"
description: "Learn to integrate Snowflake with Dagster using a Snowflake resource."
---

# Integrating Snowflake with Dagster using resources

This tutorial focuses on how to store and load Dagster's [Software-defined Assets (SDAs)](/concepts/assets/software-defined-assets) in Snowflake by using Dagster's <PyObject object="SnowflakeResource" module="dagster_snowflake" />

By the end of the tutorial, you will:

- Configure a Snowflake resource
- Use the Snowflake resource to execute a SQL query that creates a table
- Load Snowflake tables in downstream assets

**Prefer to use an I/O manager?** Refer to the [Snowlake I/O manager guide](/integrations/snowflake/using-snowflake-with-dagster-io-manager).

---

## Prerequisites

To complete this tutorial, you'll need:

- **To install the `dagster-snowflake` and `dagster-snowflake-pandas` libraries**:

  ```shell
  pip install dagster-snowflake dagster-snowflake-pandas
  ```

- **To gather the following information**, which is required to use the Snowflake resource:

  - **Snowflake account name**: You can find this by logging into Snowflake and getting the account name from the URL:

    <Image
    src="/images/integrations/snowflake/snowflake-account.png"
    width={1456}
    height={72}
    />

  - **Snowflake credentials**: You can authenticate with Snowflake two ways: with a username and password or with a username and private key.

    The Snowflake resource can read these authentication values from environment variables. In this guide, we use password authentication and store the username and password as `SNOWFLAKE_USER` and `SNOWFLAKE_PASSWORD`, respectively:

    ```shell
    export SNOWFLAKE_USER=<your username>
    export SNOWFLAKE_PASSWORD=<your password>
    ```

    Refer to the [Using environment variables and secrets guide](/guides/dagster/using-environment-variables-and-secrets) for more info.

    For more information on authenticating with a private key, see [Authenticating with a private key](/integrations/snowflake/reference#authenticating-using-a-private-key) in the Snowflake reference guide.

---

## Step 1: Configure the Snowflake resource

To use the <PyObject object="SnowflakeResource" module="dagster_snowflake" />, you'll need to add it to your <PyObject object="Definitions" /> object. Additionally, the <PyObject object="SnowflakeResource" module="dagster_snowflake" /> requires some configuration:

- **The `account` and `user` values are required.**
- **One method of authentication is required**, either by using a password or a private key.
- **Optional**: Using the `warehouse`, `schema`, and `role` attributes, you can specify where data should be stored and a `role` for the resource to use.

```python file=/integrations/snowflake/resource_tutorial/configuration.py startafter=start_example endbefore=end_example
from dagster_snowflake import SnowflakeResource

from dagster import Definitions, EnvVar

defs = Definitions(
    assets=[iris_dataset],
    resources={
        "snowflake": SnowflakeResource(
            account="abc1234.us-east-1",  # required
            user=EnvVar("SNOWFLAKE_USER"),  # required
            password=EnvVar("SNOWFLAKE_PASSWORD"),  # password or private key required
            database="FLOWERS",  # required
            role="writer",  # optional, defaults to the default role for the account
            warehouse="PLANTS",  # optional, defaults to default warehouse for the account
            schema="IRIS",  # optional, defaults to PUBLIC
        )
    },
)
```

With this configuration, if you materialized an asset called `iris_dataset`, the <PyObject object="SnowflakeResource" module="dagster_snowflake" /> would be permissioned with the role `writer` and store the data in the `FLOWERS.IRIS.IRIS_DATASET` table in the `PLANTS` warehouse.

Finally, in the <PyObject object="Definitions" /> object, we assign the <PyObject module="dagster_snowflake" object="SnowflakeResource" /> to the `snowflake` key.

For more info about each of the configuration values, refer to the <PyObject module="dagster_snowflake" object="SnowflakeResource" /> API documentation.

---

## Step 2: Create tables in Snowflake

<TabGroup>
<TabItem name="Create tables in Snowflake from Dagster assets">

### Create tables in Snowflake from Dagster assets

Using the Snowflake resource, you can create Snowflake tables using the Snowflake Python API:

```python file=/integrations/snowflake/resource_tutorial/create_table.py
import pandas as pd
from dagster_snowflake import SnowflakeResource

from dagster import asset


@asset
def iris_dataset(snowflake: SnowflakeResource) -> None:
    return pd.read_csv(
        "https://docs.dagster.io/assets/iris.csv",
        names=[
            "sepal_length_cm",
            "sepal_width_cm",
            "petal_length_cm",
            "petal_width_cm",
            "species",
        ],
    )

    with snowflake.get_connection() as conn:
        conn.execute("CREATE TABLE iris.iris_dataset AS SELECT * FROM iris_df")
```

In this example, we've defined an asset that fetches the Iris dataset as a Pandas DataFrame and renames the columns. Then, using the Snowflake resource, the DataFrame is stored in Snowflake as the `IRIS.IRIS_DATASET` table.

</TabItem>
<TabItem name="Make existing tables available in Dagster">

### Make existing tables available in Dagster

If you have existing tables in Snowflake and other assets defined in Dagster depend on those tables, you may want Dagster to be aware of those upstream dependencies.

Making Dagster aware of these tables allows you to track the full data lineage in Dagster. You can accomplish this by creating [source assets](/concepts/assets/software-defined-assets#defining-external-asset-dependencies) for these tables. For example:

```python file=/integrations/snowflake/source_asset.py
from dagster import SourceAsset

iris_harvest_data = SourceAsset(key="iris_harvest_data")
```

In this example, we created a <PyObject object="SourceAsset" /> for a pre-existing table called `iris_harvest_data`.

Since we supplied the database and the schema in the resource configuration in [Step 1](#step-1-configure-the-snowflake-resource), we only need to provide the table name. We did this by using the `key` parameter in our <PyObject object="SourceAsset" />. When the `iris_harvest_data` needs to be loaded in a downstream asset, the data in the `FLOWERS.IRIS.IRIS_HARVEST_DATA` table will be selected and provided to the asset.

</TabItem>
</TabGroup>

---

## Step 3: Define downstream assets

Once you've created an asset that represents a table in Snowflake, you'll likely want to create additional assets that work with the data. For example:

```python file=/integrations/snowflake/resource_tutorial/downstream.py startafter=start_example endbefore=end_example
import pandas as pd
from create_table import iris_dataset
from dagster_snowflake import SnowflakeResource

from dagster import asset

# this example uses the iris_dataset asset from Step 2


@asset(deps=[iris_dataset])
def iris_setosa(snowflake: SnowflakeResource) -> None:
    with snowflake.get_connection() as conn:
        conn.execute(
            "CREATE TABLE iris.iris_setosa AS SELECT * FROM iris.iris_dataset WHERE"
            " species = 'Iris-setosa'"
        )
```

In this asset, we've created a second table that only contains the data for the _Iris Setosa_ species. To do this, we defined a dependency on the `iris_dataset` asset using the `deps` parameter. Then, the SQL query will run and create the table of _Iris Setosa_ data.

---

## Completed code example

When finished, your code should look like the following:

```python file=/integrations/snowflake/resource_tutorial/full_example.py
import pandas as pd
from dagster_snowflake import SnowflakeResource

from dagster import Definitions, EnvVar, SourceAsset, asset

iris_harvest_data = SourceAsset(key="iris_harvest_data")


@asset
def iris_dataset(snowflake: SnowflakeResource) -> None:
    return pd.read_csv(
        "https://docs.dagster.io/assets/iris.csv",
        names=[
            "sepal_length_cm",
            "sepal_width_cm",
            "petal_length_cm",
            "petal_width_cm",
            "species",
        ],
    )

    with snowflake.get_connection() as conn:
        conn.execute("CREATE TABLE iris.iris_dataset AS SELECT * FROM iris_df")


@asset(deps=[iris_dataset])
def iris_setosa(snowflake: SnowflakeResource) -> None:
    with snowflake.get_connection() as conn:
        conn.execute(
            "CREATE TABLE iris.iris_setosa AS SELECT * FROM iris.iris_dataset WHERE"
            " species = 'Iris-setosa'"
        )


defs = Definitions(
    assets=[iris_dataset, iris_harvest_data, iris_setosa],
    resources={
        "snowflake": SnowflakeResource(
            account="abc1234.us-east-1",
            user=EnvVar("SNOWFLAKE_USER"),
            password=EnvVar("SNOWFLAKE_PASSWORD"),
            database="FLOWERS",
            role="writer",
            warehouse="PLANTS",
            schema="IRIS",
        )
    },
)
```

---

## Related

For more Snowflake features, refer to the [Snowflake reference](/integrations/snowflake/reference).

For more information on Software-defined Assets, refer to the [tutorial](/tutorial) or the [Assets concept documentation](/concepts/assets/software-defined-assets).

For more information onresources, refer to the [Resource documentation](/concepts/resources).
